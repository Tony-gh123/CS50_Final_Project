{% extends 'main/land.html' %}
{% load static %}

{% block title %}PDF Helper | Appointments{% endblock %}
{% block more_css %}
<link rel="stylesheet" type="text/css" href="{% static 'main/css/calendar.css' %}">
{% endblock %}

{% block content %}
<!-- Book Appointment -->
    <div class="container">
        <p class="title"> My Appointments </p>
        <div class="calendar">
            {% if appointments %}
            <!-- view current appointments -->
            <div class="view-appointments">
                <div class="view-list">
                    {% for appointment in appointments %}
                    {% if appointment.status != 'cancelled' and appointment.status != 'completed' %}
                    <div class="view-appointment">
                        <!-- Find Recipient -->
                        <p>Recipient: 
                        {% if user == appointment.admin %}
                            {{ appointment.user.username }}
                        {% else %} 
                            {{ appointment.admin.username }} 
                        {% endif %}
                        </p>
                        <!-- Rest of fields -->
                        <p>Date: {{ appointment.date }}</p>
                        <p>Time: {{ appointment.time }}</p>
                        <p>Duration: {{ appointment.duration }}</p>
                        <p>Reason: {{ appointment.reason }}</p>
                        <p>Comments: {{ appointment.comments }}</p>

                        <!-- Cancel Appointments -->
                        <div class="view-cancel">
                            {% if appointment.status == 'scheduled' or appointment.status == 'completed' %}
                            <form method="post" action="{% url 'calendar' %}">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="cancel">
                                <input type="hidden" name="appointment_id" value="{{ appointment.id }}">
                                <button type="submit">Cancel</button>
                            </form>
                            {% endif %}
                    </div>
                    {% endif %}
                    {% endfor %}
                </div> 
                <!-- No Appointments -->
                {% else %}
                <p>No appointments scheduled</p>
                {% endif %}
            </div>

            <!-- view past appointments -->
            <div class="past-appointments">
                {% if request.user.is_staff %}
                <form method ="post" action="{% url 'previous_apts' %}">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="previous_apts">
                    <button class="btn btn-primary" type="submit">All Apts</button>
                </form>
                {% endif %}
            </div>

            <!-- schedule a new appointment -->
            <p class="title"> New Appointment </p>
            <div class="new-appointment">
                <form method="POST">
                    {% csrf_token %}

                    <!-- admin list (recipient) -->
                    {% if not request.user.is_staff %}
                    <div class="new-recipient">
                        <label for="recipient">To:</label>
                        <select id="recipient" name="recipient">
                            <option value="">______</option>
                            {% for admin in admins %}
                                <option value="{{ admin.id }}">{{ admin.username }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}

                    <!-- user list (recipient)-->
                    {% if request.user.is_staff %}
                    <div class="new-recipient" action="">
                        <label for="recipient">To:</label>
                        <select id="recipient" name="recipient">
                            <option value="">______</option>
                            {% for user in users %}
                                <option value="{{ user.id }}">{{ user.username }}</option>
                            {% endfor %}
                        </select>
                    </div>                        
                    {% endif %}

                    <!-- more form fields -->
                    <div class="new-reason">
                        <input type="text" name="reason" placeholder="Reason for appointment">
                    </div>
                    <div class="new-info">
                        <div class="date">
                            <p class="info-date">
                                <label for="date">Date:</label>
                                <input type="date" id="date" name="date">
                            </p>
                            <p class="info-time">
                                <label for="time">Time:</label>
                                <input type="time" id="time" name="time">
                            </p>
                        </div>
                        <div class="duration">
                            <p>
                                <label for="duration">Duration: (minutes):</label>
                                <input type="number" id="duration" name="duration">
                            </p>
                        </div>
                        <div class="comments">
                            <p>
                                <label for="comments">Comments:</label>
                                <input type="text" id="comments" name="comments" placeholder="Example: Meet me inside">
                            </p>
                        </div>
                    </div>
                    
                    <!-- Confirm or dismiss schedule -->
                    <div class="new-actions">
                        <button class="btn btn-primary" name="action" value="save" type="submit">Save</button>
                        <button class="btn btn-primary" name="action" value="dismiss" type="submit">Dismiss</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}